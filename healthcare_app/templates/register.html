{% extends "base.html" %}
{% block title %}Register{% endblock %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script>
    function toggleForm(role) {
      const patientForm = document.getElementById("patientForm");
      const doctorForm = document.getElementById("doctorForm");
      const adminForm = document.getElementById("adminForm");

      if (role === "patient") {
        patientForm.style.display = "block";
        doctorForm.style.display = "none";
        adminForm.style.display = "none";
        setRequired(true, patientForm);
        setRequired(false, doctorForm);
        setRequired(false, adminForm);
      } else if (role === "doctor") {
        patientForm.style.display = "none";
        doctorForm.style.display = "block";
        adminForm.style.display = "none";
        setRequired(false, patientForm);
        setRequired(true, doctorForm);
        setRequired(false, adminForm);
      } else if (role === "admin"){
        patientForm.style.display = "none";
        doctorForm.style.display = "none";
        adminForm.style.display = "block";
        setRequired(false, patientForm);
        setRequired(false, doctorForm);
        setRequired(true, adminForm);
      } else {
        patientForm.style.display = "none";
        doctorForm.style.display = "none";
        adminForm.style.display = "none";
        setRequired(false, patientForm);
        setRequired(false, doctorForm);
        setRequired(false, adminForm);
      }
    }

    function setRequired(state, form) {
      const inputs = form.querySelectorAll("input");
      inputs.forEach(input => {
        if (input.type !== "checkbox" && input.name !== "bmi") {
          input.required = state;
        }
      });
    }

    function calculateBMI() {
      const height = parseFloat(document.getElementById("height").value);
      const weight = parseFloat(document.getElementById("weight").value);
      if (!isNaN(height) && !isNaN(weight)) {
        const bmi = weight / ((height / 100) ** 2);
        document.getElementById("bmi").value = bmi.toFixed(2);
      }
    }

    function toggleHospital() {
      const checkbox = document.getElementById("notWorking");
      const hospitalField = document.getElementById("hospital");
      if (checkbox.checked) {
        hospitalField.disabled = true;
        hospitalField.required = false;
        hospitalField.value = "Not Working";
      } else {
        hospitalField.disabled = false;
        hospitalField.required = true;
        hospitalField.value = "";
      }
    }

    window.onload = () => {
      toggleForm(""); // Hide all role-specific on page load
    };
  </script>
</head>
<body>
  <h2>Register</h2>


  <form method="POST" action="/register">
    <label for="role">Register as:</label>
    <select name="role" id="role" onchange="toggleForm(this.value)" required>
      <option value="">Select</option>
      <option value="patient">Patient</option>
      <option value="doctor">Doctor</option>
      <option value="admin">Admin</option>
    </select>

    <br><br>

    <div id="commonFields">
      <label>Name:</label>
      <input type="text" name="name" required>

      <label>Address:</label>
      <input type="text" name="address" required>

      <label>Username / Contact Number:</label>
      <input type="text" name="contact" required>

      <label>Password:</label>
      <input type="password" name="password" required>
    </div>

    <div id="patientForm" style="display:none;">
      <label>Date of Birth:</label>
      <input type="date" name="dob">

      <label>Height (cm):</label>
      <input type="number" id="height" name="height" oninput="calculateBMI()">

      <label>Weight (kg):</label>
      <input type="number" id="weight" name="weight" oninput="calculateBMI()">

      <label>BMI:</label>
      <input type="text" id="bmi" name="bmi" readonly>
    </div>

    <div id="doctorForm" style="display:none;">
      <label>Specialization:</label>
      <input type="text" name="specialization">

      <label>Hospital Working At:</label>
      <input type="text" id="hospital" name="hospital">
      <input type="checkbox" id="notWorking" onchange="toggleHospital()">
      <label for="notWorking">Currently Not Working</label>

      <label>Years of Experience:</label>
      <input type="number" name="experience" min="0">

      <label>Location:</label>
      <input type="text" name="location">
    </div>

    <div id="adminForm" style="display:none;">
      <label >AdminID:</label>
      <input type="number" name="adminid" min="0">
    </div>

    <br>
    <button type="submit">Register</button>
  </form>
</body>
</html>
{% endblock %}
